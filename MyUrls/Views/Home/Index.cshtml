@model List<MyUrls.Models.UrlModel>
@using MyUrls.Models

<!-- Floating Button to Open Modal -->
<button type="button" class="btn btn-primary btn-floating shadow-lg" data-bs-toggle="modal" data-bs-target="#addUrlModal">
    Add
    <i class="bi bi-plus-lg"></i>
</button>

<!-- Modal for Adding URL -->
<div class="modal fade" id="addUrlModal" tabindex="-1" aria-labelledby="addUrlModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content shadow-sm">
            <div class="modal-header">
                <h5 class="modal-title" id="addUrlModalLabel">Add New URL</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" asp-action="AddUrl">
                    <div class="form-group mb-3">
                        <label for="url">URL:</label>
                        <input type="text" class="form-control form-control-sm" id="url" name="url" placeholder="Enter URL" required />
                    </div>
                    <div class="form-group mb-3">
                        <label for="description">Description:</label>
                        <input type="text" class="form-control form-control-sm" id="description" name="description" placeholder="Enter description" required />
                    </div>
                    <div class="form-group mb-3">
                        <label for="tag">Tag:</label>
                        <select class="form-control form-control-sm" id="tag" name="tag" required>
                            <option value="آساپی">آساپی</option>
                            <option value="دایرکت دبیت">دایرکت دبیت</option>
                        </select>
                    </div>
                    <div class="form-group mb-3">
                        <label for="environment">Environment:</label>
                        <select class="form-control form-control-sm" id="environment" name="environment">
                            <option value="Dev">Dev</option>
                            <option value="Beta">Beta</option>
                            <option value="Stage">Stage</option>
                            <option value="Prod">Prod</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm w-100">Add URL</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal for Delete Confirmation -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content shadow-sm">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this URL?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteForm" method="post" asp-action="DeleteUrl">
                    <input type="hidden" name="id" id="deleteId" />
                    <button type="submit" class="btn btn-danger btn-sm">Yes</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Column structure based on environments -->


<div class="row mt-4">
    @foreach (EnvironmentType envType in Enum.GetValues(typeof(EnvironmentType)))
    {
        <div class="col-md-6 col-lg-3 mb-4">
            <h4 class="text-primary">@envType</h4>
            @foreach (var url in Model.Where(u => u.Environment == envType))
            {
                <div class="card p-2 mb-3 shadow-sm">
                    <h6 class="mb-1 text-secondary">
                        @url.Description
                        <span class="badge tag-badge @(url.Tag == "آساپی" ? "bg-asapi" : "bg-directDebit")">@url.Tag</span>
                    </h6>
                    <div class="input-group input-group-sm mb-2">
                        <input type="text" class="form-control" value="@url.Url" readonly />
                        <button class="btn btn-outline-secondary btn-sm" onclick="copyToClipboard('@url.Url')">Copy</button>
                    </div>
                    <div class="btn-group btn-group-sm w-100" role="group">
                        <a href="@url.Url" target="_blank" class="btn btn-outline-secondary">Open</a>
                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmationModal" onclick="setDeleteId(@url.Id)">
                            Delete
                        </button>
                    </div>
                </div>
            }
        </div>
    }
</div>

<script>
    function setDeleteId(id) {
        document.getElementById('deleteId').value = id;
    }

    function copyToClipboard(url) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(url).then(() => {
                alert('URL copied to clipboard');
            }).catch((err) => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy URL. Please try again!');
            });
        } else {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = url;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                document.execCommand('copy');
                alert('URL copied to clipboard');
            } catch (err) {
                alert('Failed to copy URL. Please try again!');
            }
            document.body.removeChild(tempTextArea);
        }
    }

</script>

<style>
    /* Floating button styles */
    .btn-floating {
        position: fixed;
        bottom: 20px;
        left: 20px;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 18px;
        padding: 10px;
        z-index: 1000;
    }

    /* Modal styling */
    .modal-content {
        border-radius: 10px;
    }

    /* Card styling */
    .card {
        border: 1px solid #e3e3e3;
        border-radius: 8px;
    }

    /* Environment titles */
    h4.text-primary {
        border-bottom: 2px solid #007bff;
        padding-bottom: 5px;
        font-size: 1.25rem;
    }

    .footer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 10px 15px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        font-size: 0.9rem;
        color: #333;
        text-align: center;
        z-index: 1000;
        margin-bottom: 0rem;
        
    }

    .tag-badge {
        font-size: 0.7rem; /* اندازه کوچک */
        padding: 0.2em 0.5em; /* فاصله داخلی */
        border-radius: 10px; /* گوشه‌های گرد */
        margin-left: 5px; /* فاصله از توضیحات */
    }

    .bg-asapi {
        background-color: #17a2b8; /* رنگ برای آساپی */
        color: white; /* رنگ متن */
    }

    .bg-directDebit {
        background-color: #28a745; /* رنگ برای دایرکت دبیت */
        color: white; /* رنگ متن */
    }

    .custom-title {
        font-family: 'Arial', sans-serif; /* فونت دلخواه */
        font-size: 2.5rem; /* اندازه بزرگ */
        font-weight: bold; /* ضخیم */
        color: #007bff; /* رنگ آبی */
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); /* سایه */
        border-bottom: 2px solid #007bff; /* خط زیر */
        padding-bottom: 10px; /* فاصله زیر */
        margin-bottom: 20px; /* فاصله پایین */
    }
</style>

<footer class="footer">
    <h6>Created by Fara</h6>
</footer>